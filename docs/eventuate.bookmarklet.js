(()=>{"use strict";var e={65:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ResultsPageExtractor=void 0;const n=r(768);function s(e){return Number(e?.split("/")?.slice(-1))}t.ResultsPageExtractor=class{eventName;courseLength;eventDate;eventNumber;finishers;unknowns;newestParkrunners;firstTimers;finishersWithNewPBs;runningWalkingGroups;facts={finishers:0,finishes:0,pbs:0,volunteers:0};resultsPageDocument;constructor(e){this.resultsPageDocument=e,this.eventName=e.querySelector(".Results-header > h1")?.textContent??void 0,this.courseLength=this.eventName?.includes("junior parkrun")?2:5;const t=e.querySelectorAll(".Results-table-row");this.finishers=Array.from(t).map((e=>new n.Finisher(this.removeSurnameFromJunior(e.dataset.name),e.dataset.agegroup,e.dataset.club,e.dataset.gender,e.dataset.position,e.dataset.runs,e.dataset.vols,e.dataset.agegrade,e.dataset.achievement,e.querySelector(".Results-table-td--time .compact")?.textContent??void 0,s(e.querySelector(".Results-table-td--name a")?.href)))),this.populateVolunteerData(),this.eventDate=e.querySelector(".format-date")?.textContent??void 0,this.eventNumber=e.querySelector(".Results-header > h3 > span:last-child")?.textContent||void 0,this.unknowns=this.finishers.filter((e=>0===Number(e.runs))).map((()=>"Unknown")),this.newestParkrunners=this.finishers.filter((e=>1===Number(e.runs))).map((e=>e.name)),this.firstTimers=Array.from(t).filter((e=>e.querySelector("td.Results-table-td--ft")&&Number(e.dataset.runs)>1)).map((e=>this.removeSurnameFromJunior(e.dataset.name))),this.finishersWithNewPBs=Array.from(t).filter((e=>e.querySelector("td.Results-table-td--pb"))).map((e=>`${this.removeSurnameFromJunior(e.dataset.name)} (${e.querySelector(".Results-table-td--time .compact")?.textContent})`)),this.runningWalkingGroups=Array.from(new Set(this.finishers.map((e=>e?.club||"")).filter((e=>""!==e))));const[,r,o,i,a,,,]=Array.from(document.querySelectorAll(".aStat")).map((e=>e?.textContent?.replace(/^[^:]*:/,"").trim()));this.facts.finishers=r?Number(r):0,this.facts.finishes=o?Number(o):0,this.facts.pbs=a?Number(a):0,this.facts.volunteers=i?Number(i):0}volunteerElements(){return this.resultsPageDocument.querySelectorAll(".Results + div h3:first-of-type + p:first-of-type a")}removeSurnameFromJunior(e){if(!e||5==this.courseLength)return e??"";{const t=e.split(" ");if(2===t.length)return t[0]}return e.replace(/[-' A-Z]+$/,"")}populateVolunteerData(){this.volunteerElements().forEach((e=>{const t=s(e.href);if(e.dataset.athleteid||(e.dataset.athleteid=t.toString()),!e.dataset.vols||!e.dataset.agegroup){const r=this.finishers.find((e=>e.athleteID===t));r&&(e.dataset.vols=r?.vols?.toString(),e.dataset.agegroup=r?.agegroup,e.dataset.vols_source="finisher")}}))}volunteersList(){return Array.from(this.volunteerElements()).map((e=>({name:this.removeSurnameFromJunior(e.innerText),link:e.href,athleteID:Number(e.dataset.athleteid),agegroup:e.dataset.agegroup,vols:Number(e.dataset.vols)})))}}},97:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VolunteerPageExtractor=void 0,t.VolunteerPageExtractor=class{vols;agegroup;constructor(e){const t=e.querySelector("#content > p:last-of-type")?.textContent??"";this.vols=Number(e.querySelector("h3#volunteer-summary + table tfoot td:last-child")?.textContent),this.agegroup=t.trim().split(" ").slice(-1)[0]??"Not found on page"}}},137:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fiveKVolunteersToMilestones=function(e){const t={10:{icon:"ðŸ¤",restricted_age:"J"},25:{icon:"ðŸ’œ"},50:{icon:"â¤ï¸"},100:{icon:"ðŸ–¤"},250:{icon:"ðŸ’š"},500:{icon:"ðŸ’™"},1e3:{icon:"ðŸ’›"}},r=[];for(const n in t){const s=t[n],o=e.filter((e=>e.vols===Number(n)&&(!s.restricted_age||e.agegroup?.startsWith(s.restricted_age)))).map((e=>e.name));o.length>0&&r.push({clubName:`v${n}`,icon:s.icon,names:o})}return r}},180:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VolunteerWithCount=void 0;const n=r(97);t.VolunteerWithCount=class{name;link;athleteID;vols;agegroup;volunteerDataSource;promisedVols;constructor(e){this.name=e.name,this.link=e.link;const t=new URL(e.link);this.volunteerDataSource=new URL(t.pathname.split("/").slice(2).join("/"),t.origin),this.athleteID=e.athleteID,this.vols=e.vols??0,this.agegroup=e.agegroup??"",this.vols||(this.promisedVols=this.fetchdata())}fetchdata(){const e=sessionStorage.getItem(this.athleteID.toString());if(!e)return fetch(this.volunteerDataSource).then((e=>e.text())).then((e=>this.volsFromHtml(e)));{const t=JSON.parse(e);this.vols=Number(t.vols),this.agegroup=t.agegroup}}volsFromHtml(e){const t=new n.VolunteerPageExtractor((new DOMParser).parseFromString(e,"text/html"));return this.vols=t.vols,this.agegroup=t.agegroup,sessionStorage.setItem(this.athleteID.toString(),JSON.stringify(t)),t}}},196:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MilestonePresenter=void 0;const n=r(846);t.MilestonePresenter=class{_milestoneCelebrations;_milestoneCelebrationsAll;constructor(e){this._milestoneCelebrations=e,this._milestoneCelebrationsAll=this._milestoneCelebrations.flatMap((e=>e.names))}title(){return`Three cheers to the ${(0,n.pluralize)("parkrunner","parkrunners",this._milestoneCelebrationsAll.length)} who joined a new parkrun milestone club this weekend:\n`}details(){return this._milestoneCelebrations.map((e=>`${e.icon} ${(0,n.sortAndConjoin)(e.names)} joined the ${e.clubName}-club`)).join("\n")}}},267:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.twoKVolunteersToMilestones=function(e){const t=e.filter((e=>5===e.vols&&e.agegroup?.startsWith("J"))).map((e=>e.name));return t.length?[{clubName:"junior parkrun v5",icon:"ðŸ’Ÿ",names:t}]:[]}},597:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fiveKFinishersToMilestones=function(e){const t={10:{icon:"âšªï¸Ž",restricted_age:"J"},25:{icon:"ðŸŸ£"},50:{icon:"ðŸ”´"},100:{icon:"âš«"},250:{icon:"ðŸŸ¢"},500:{icon:"ðŸ”µ"},1e3:{icon:"ðŸŸ¡"}},r=[];for(const n in t){const s=t[n],o=e.filter((e=>Number(e.runs)===Number(n)&&(!s.restricted_age||e.agegroup?.startsWith(s.restricted_age)))).map((e=>e.name));o.length>0&&r.push({clubName:n,icon:s.icon,names:o})}return r}},768:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Finisher=void 0,t.Finisher=class{name;agegroup;club;gender;position;runs;vols;agegrade;achievement;time;athleteID;constructor(e,t,r,n,s,o,i,a,l,u,c){this.name=e??"a parkrunner",this.agegroup=t,this.club=r,this.gender=n,this.position=s,this.runs=o??"0",this.vols=i,this.agegrade=a,this.achievement=l,this.time=u,this.athleteID=c}isUnknown(){return"0"===this.runs}}},846:(e,t)=>{function r(e){return e.length>1?`${e.slice(0,-1).join(", ")} and ${e.slice(-1)}`:e[0]}function n(e){return e.sort(((e,t)=>e.localeCompare(t)))}Object.defineProperty(t,"__esModule",{value:!0}),t.pluralize=function(e,t,r){return 1===r?e:`${r} ${t}`},t.conjoin=r,t.alphabetize=n,t.sortAndConjoin=function(e){return r(n(e))}},900:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.upsertParagraph=function(e,t,r){const n=Array.from(e.children).find((e=>e.id===t));n&&n.remove();const s=document.createElement("p");return s.id=t,s.innerText=r,e.appendChild(s),s},t.deleteParagraph=function(e,t){const r=Array.from(e.children).find((e=>e.id===t));r&&r.remove()}},932:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.twoKFinishersToMilestones=function(e){const t={11:{icon:"ðŸŸ¦",restricted_age:"J",name:"Half marathon"},21:{icon:"ðŸŸ©",restricted_age:"J",name:"Marathon"},50:{icon:"ðŸŸ§",restricted_age:"J",name:"Ultra marathon"},100:{icon:"â¬œ",restricted_age:"J",name:"junior parkrun 100"},250:{icon:"ðŸŸ¨",restricted_age:"J",name:"junior parkrun 250"}},r=[];for(const n in t){const s=t[n],o=e.filter((e=>Number(e.runs)===Number(n)&&(!s.restricted_age||e.agegroup?.startsWith(s.restricted_age)))).map((e=>e.name));o.length>0&&r.push({clubName:s.name,icon:s.icon,names:o})}return r}}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}(()=>{const e=r(846),t=r(900),n=r(597),s=r(137),o=r(196),i=r(65),a=r(932),l=r(267),u=r(180);function c(r,i,u){const c=`On parkrunday, ${r.finishers.length} parkrunners joined us for event ${r.eventNumber} and completed the ${r.courseLength}km ${r.eventName} course`,h=`Kudos to our ${(0,e.pluralize)("newest parkrunner","newest parkrunners",r.newestParkrunners.length)}: `,d=`Welcome to the ${(0,e.pluralize)("parkrunner","parkrunners",r.firstTimers.length)} who joined us at ${r.eventName??"parkrun"} for the first time: `,m=`Very well done to the ${(0,e.pluralize)("parkrunner","parkrunners",r.finishersWithNewPBs.length)} who improved their personal best this week: `,p=`We were pleased to see ${(0,e.pluralize)("at least one active group","walking and running groups",r.runningWalkingGroups.length)} represented at this event: `,g=i.map((e=>e.vols)).reduce(((e,t)=>e+t),0),f=`The following ${i.length.toLocaleString()} superstars have volunteered a total of ${g.toLocaleString()} times between them, and helped us host ${r.eventName} this weekend. Our deep thanks to:  `,v=2==r.courseLength?[...(0,l.twoKVolunteersToMilestones)(i),...(0,a.twoKFinishersToMilestones)(r.finishers)]:(0,n.fiveKFinishersToMilestones)(r.finishers),b=[...(0,s.fiveKVolunteersToMilestones)(i),...v],w=new o.MilestonePresenter(b),k=`Since ${r.eventName} started ${r.facts?.finishers?.toLocaleString()} brilliant parkrunners have had their barcodes scanned, and a grand total of ${r.facts.finishes.toLocaleString()} finishers have covered a total distance of ${(r.facts.finishes*r.courseLength).toLocaleString()}km, while celebrating ${r.facts.pbs.toLocaleString()} personal bests. We shall always be grateful to each of our ${r.facts.volunteers.toLocaleString()} wonderful volunteers for their contributions`,y=document.getElementById("eventuate")||document.createElement("div");y.id="eventuate";const _={message:{title:"â³ï¸Ž",details:u},introduction:{title:"",details:c},milestoneCelebrations:{title:w.title(),details:w.details()},newestParkrunners:{title:h,details:(0,e.sortAndConjoin)(r.newestParkrunners)},firstTimers:{title:d,details:(0,e.sortAndConjoin)(r.firstTimers)},newPBs:{title:m,details:(0,e.sortAndConjoin)(r.finishersWithNewPBs)},groups:{title:p,details:(0,e.sortAndConjoin)(r.runningWalkingGroups)},volunteers:{title:f,details:(0,e.sortAndConjoin)(i.map((e=>e.name)))},unknowns:{title:"",details:r.unknowns.length>0?`Please don't forget to bring a scannable copy of your barcode with you to ${r.eventName} if you'd like to have your time recorded`:void 0},facts:{title:"",details:k}},P=document.querySelector(".Results-header");if(P){P.insertAdjacentElement("afterend",y);for(const[e,r]of Object.entries(_))if(r.details){const n=`${r.title} ${r.details}.`;(0,t.upsertParagraph)(y,e,n)}else(0,t.deleteParagraph)(y,e)}}!function(){const e=new i.ResultsPageExtractor(document),t=e.volunteersList().map((e=>new u.VolunteerWithCount(e))),r=t.map((e=>e.promisedVols)).filter((e=>!!e)),n=`Loading volunteer data for ${r.length} parkrunners. Please wait`;c(e,t,n),Promise.all(r).then((()=>c(e,t)))}()})()})();